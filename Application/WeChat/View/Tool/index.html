<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <!-- Title and other stuffs -->
    <title>旅之沙</title>
    <meta name="keywords" content="Bootstrap" />
    <meta name="description" content="Bootstrap" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="">
    <!-- Stylesheets -->
    <link href="{$Think.const.SITE_STYLE_URL}/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="{$Think.const.SITE_STYLE_URL}/font-awesome.css">
    <link href="{$Think.const.SITE_STYLE_URL}/style.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="{$Think.const.SITE_STYLE_URL}/bootstrap-responsive.css">-->

    <!-- HTML5 Support for IE -->
    <!--[if lt IE 9]>
    <script src="{$Think.const.SITE_JAVASCRIPT_URL}/html5shim.js"></script>
    <![endif]-->

    <!-- Favicon -->
    <link rel="shortcut icon" href="{$Think.const.SITE_IMAGE_URL}/favicon/favicon.png">
    <script src="{$Think.const.SITE_JAVASCRIPT_URL}/jquery.js"></script> <!-- jQuery -->
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="{$Think.const.SITE_JAVASCRIPT_URL}/bootstrap.js"></script> <!-- Bootstrap -->
    <script src="{$Think.const.SITE_JAVASCRIPT_URL}/jquery.rotate.min.js"></script> <!-- Bootstrap -->
</head>
<style>
    .numberspan{
        width:35px;
        height:59px;
        display:inline-block;
        font-size: 20px;
        line-height: 53px;
    }
    .col-image{
        width:50px;height:50px;border-radius: 50%;
    }
    .col-p{
        text-align: center;margin-top:10px;
    }
    .bottomspan{
        width:31%;
        display:inline-block;
        line-height: 37px;
        margin-left: 1.4%;
        margin-top: 5px;
        margin-bottom: 5px;
        cursor: pointer;
    }
    .bottom-active{
        background-color: #BEDDDD;
        color: #337ab7;
    }
    .text-p{
        text-align: center;
        line-height: 23px;
    }
    .text-image{
        text-align:center;font-size: 20px;margin-left:3px;margin-top:2px;
    }
</style>
<body>
<!-- 登陆确认层 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="background:rgba(255,255,255,0.7) none repeat scroll 0 0 !important;">
            <div class="modal-body" style="text-align: center">
                <input name="numberid" type="hidden">
                <button type="button" class="btn btn-primary confirmsubmit" style="width: 40%;margin-top:75%">确认登陆</button>
            </div>
        </div>
    </div>
</div>
<!-- 登陆确认层  end -->

<div class="container" style="margin-top: -40px;">
   <div class="tool-middle">
       <div class="row" style="background-color: #e6e6e6;padding-top:30px;padding-bottom: 26px">
           <div class="col-xs-9"style="text-align: center">
               <span class="label label-info numberspan">8</span>
               <span class="label label-info numberspan">2</span>
               <span class="label label-info numberspan">0</span>
               <span class="label label-info numberspan">5</span>
               <span class="label label-info numberspan">4</span>
               <span class="label label-info numberspan">8</span>
           </div>
           <div class="col-xs-3" id="saoyisao">
               <p style="text-align:center;margin-top:5px;"><a href="javascript:;" style="font-size: 38px;"><span class="glyphicon glyphicon-qrcode"></span></a></p>
               <p style="text-align: center"><a href="javascript:;">安全扫一扫</a></p>
           </div>
       </div>
       <div class="row">
           <div class="col-xs-4">
               <p style="text-align:center;margin-top:25px;"><img src="{$Think.const.SITE_IMAGE_URL}/lock_256px.png" class="col-image" alt="..."></p>
               <p class="col-p"><a href="#">修改密码</a></p>
           </div>
           <div class="col-xs-4">
               <p style="text-align:center;margin-top:25px;"><img src="{$Think.const.SITE_IMAGE_URL}/pin_256px.png" class="col-image" alt="..."></p>
               <p class="col-p">更新位置</p>
           </div>
           <div class="col-xs-4">
               <p style="text-align:center;margin-top:25px;"><img src="{$Think.const.SITE_IMAGE_URL}/security_256px.png" class="col-image" alt="..."></p>
               <p class="col-p"><a href="#">安全扫一扫</a></p>
           </div>
       </div>
       <div class="row">
       <div class="col-xs-4">
           <p style="text-align:center;margin-top:25px;"><img src="{$Think.const.SITE_IMAGE_URL}/paint_256px.png" class="col-image" alt="..."></p>
           <p class="col-p"><a href="#">安全扫一扫</a></p>
       </div>
       <div class="col-xs-4">
           <p style="text-align:center;margin-top:25px;"><img src="{$Think.const.SITE_IMAGE_URL}/scissors_256px.png" class="col-image" alt="..."></p>
           <p class="col-p"><a href="#">安全扫一扫</a></p>
       </div>
       <div class="col-xs-4">
           <p style="text-align:center;margin-top:25px;"><img src="{$Think.const.SITE_IMAGE_URL}/target_256px.png" class="col-image" alt="..."></p>
           <p class="col-p"><a href="#">安全扫一扫</a></p>
       </div>
   </div>
        <div class="row">
           <div class="col-xs-4">
               <p style="text-align:center;margin-top:25px;"><img src="{$Think.const.SITE_IMAGE_URL}/tools_256px.png" class="col-image" alt="..."></p>
               <p class="col-p"><a href="#">安全扫一扫</a></p>
           </div>
       </div>
</div>
    <div class="tool-left hidden">
        <div class="row" style="height: 30%;background-color: #337ab7;color:#ffffff">
            <div class="col-xs-10" style="margin-top:13%">
                <p style="text-align: center">已连续守护您<span style="font-size: 25px">207</span>天</p>
                <p style="text-align: center;font-size: 16px;">你的账号暂无风险</p>
            </div>
            <div class="col-xs-2" style="margin-top:18%">
                <p><span class="glyphicon glyphicon-chevron-right"></span></p>
            </div>
        </div>
        <div class="row" style="height:12%;border-bottom: solid 1px #d8d8d8">
            <div class="col-xs-10" style="margin-top: 2%">
                <p>上次登录：广东广州</p>
                <h3>当前 2次登录</h3>
            </div>
            <div class="col-xs-2" style="margin-top: 3.5%">
                <h2><span class="glyphicon glyphicon-chevron-right"></span></h2>
            </div>
        </div>
    </div>
    <div class="tool-right hidden ">

        <div class="row" style="height:50px;border-bottom: solid 1px  #e4e4e4;background-color: #f5f5f5">
            <div class="col-xs-1">
                <h3><span style="line-height:34px;color: #337ab7" class="glyphicon glyphicon-user"></span></h3>
            </div>
            <div class="col-xs-9">
                <h3 style="line-height:40px">{$userinfo.nickname}</h3>
            </div>
            <div class="col-xs-2">
                <img src="{$userinfo.avator}" style="width: 30px;height: 30px;border-radius: 50%;margin-top: 9px;">
            </div>
        </div>

        <div class="row" style="height:30px;border-bottom: solid 1px #e4e4e4;"></div>

        <!--地理位置-->
        <div class="row" style="height:50px;border-bottom: solid 1px  #e4e4e4;background-color: #f5f5f5">
            <div class="col-xs-1">
                <h3><span style="line-height:34px;color: #337ab7" class="glyphicon glyphicon-flag"></span></h3>
            </div>
            <div class="col-xs-9">
                <h3 style="line-height:40px"> 地理位置</h3>
            </div>
            <div class="col-xs-2" id="getLocation">
                <h3><span style="line-height:34px" class="glyphicon glyphicon-refresh"></span></h3>
            </div>
        </div>
        <div style="height:50px;border-bottom: solid 1px #e4e4e4;background-color: #f5f5f5" class="row">
            <div class="col-xs-1">
                <h4><span style="line-height:34px;color: #337ab7" class="glyphicon glyphicon-map-marker"></span></h4>
            </div>
            <div style="" class="col-xs-11">
                <h4 style="line-height:40px"><span style="font-size:14px;" id="address">广东省广州市荔湾区永安十四巷7号</span></h4>
            </div>

        </div>
        <div style="height:50px;border-bottom: solid 1px  #e4e4e4;background-color: #f5f5f5" class="row">
            <div class="col-xs-1">
                <h4><span style="line-height:34px;color: #337ab7" class="glyphicon glyphicon-screenshot"></span></h4>
            </div>
            <div style="" class="col-xs-11">
                <h4 style="line-height:40px"><span style="font-size:14px;" id="lng">经度：113.8765465656</span></h4>
            </div>
        </div>
        <div style="height:50px;border-bottom: solid 1px #e4e4e4;background-color: #f5f5f5" class="row">
            <div class="col-xs-1">
                <h4><span style="line-height:34px;color: #337ab7" class="glyphicon glyphicon-screenshot"></span></h4>
            </div>
            <div style="" class="col-xs-11">
                <h4 style="line-height:40px"><span style="font-size:14px;" id="lat">维度：23.725539842</span></h4>
            </div>
        </div>
        <!--地理位置 end-->
    </div>
</div>
<footer class="navbar-fixed-bottom" style="padding-bottom: 0px;" >
    <div class="container" style="background-color: #e7e7e7">
        <div class="row">
            <div class="bottomspan">
                <p class="text-image"><span class="glyphicon glyphicon-home"></span></p>
                <p class="text-p">安全</p>
            </div>
            <div class="bottomspan bottom-active">
                <p class="text-image"><span class="glyphicon glyphicon-th-large"></span></p>
                <p class="text-p">工具</p>
            </div>
            <div class="bottomspan">
                <p class="text-image"><span class="glyphicon glyphicon-user"></span></p>
                <p class="text-p">我</p>
            </div>
        </div>
    </div>
</footer>
</body>
</html>
<script>
    wx.config({
        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
        appId: "{$wxSdk.appid}", // 必填，公众号的唯一标识
        timestamp: "{$wxSdk.timestamp}", // 必填，生成签名的时间戳
        nonceStr: "{$wxSdk.noncestr}", // 必填，生成签名的随机串
        signature: "{$wxSdk.signature}",// 必填，签名，见附录1
        jsApiList: [
            'closeWindow',
            'getLocation',
            'scanQRCode',
        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
    });

    /**
     * 切换模块
     */
    $('.bottomspan').each(function(i,item){
        $(item).click(function(){
            $(item).addClass('bottom-active');
            $(item).siblings().removeClass('bottom-active');
            switch(i){
                case 0:
                    $('.tool-left').removeClass('hidden');
                    $('.tool-middle,.tool-right').addClass('hidden');
                    break;
                case 1:
                    $('.tool-middle').removeClass('hidden');
                    $('.tool-left,.tool-right').addClass('hidden');
                    break;
                case 2:
                    $('.tool-right').removeClass('hidden');
                    $('.tool-middle,.tool-left').addClass('hidden');
                    break;
            }
        });
    });
    /**
     * 用于旋转
     */
    var rotation2 = function (){
        $("#getLocation span").rotate({
            angle:0,
            animateTo:360,
            callback: rotation2,
            easing: function (x,t,b,c,d){
                return c*(t/d)+b;
            }
        });
    }
    /**
     * 更新地理位置
     */
    $('#getLocation').click(function(){
        rotation2();
        wx.getLocation({
            type: 'gcj02', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
            success: function (res) {
                longtitude = res.longitude;
                latitude  =  res.latitude;
                $.get("{:U('WeChat/Tool/getLocation')}",{'latitude':longtitude,'longitude':latitude},function(response){
                    if(response.status){
                        $("#getLocation span").stopRotate();
                        $('#lng').text('经度：' + response.lng);
                        $('#lat').text('维度：' + response.lat);
                        $('#address').text(response.address);
                    }else{
                        alert(response.msg);
                    }
                },'json');
            }
        });
    });
    /**
     * 扫一扫
     */
    $('#saoyisao').click(function(){
        wx.scanQRCode({
            needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
            scanType: ["qrCode","barCode"], // 可以指定扫二维码还是一维码，默认二者都有
            success: function (res) {
                $('.confirmsubmit').text('正在验证请求...');
                $('#myModal').modal();
                $.get("{:U('WeChat/WeiXin/confirm')}",{token:res.resultStr},function(response){
                    if(response.status){
                        $('input[name=numberid]').val(response.numberid);
                        $('.confirmsubmit').text('请确认登陆');
                    }else{
                        alert(response.msg);
                    }
                });
            }
        });
    });

    var screenHeight= parseInt($(window).outerHeight()) -21;
    $('.modal-content').css('height',screenHeight + 'px');
    /**
     * 确认登陆
     */
    $('.confirmsubmit').click(function(){
        var thisobj = $(this);
        thisobj.text('正在登陆...');
        $.ajax({
            type:'post',
            url:"{:U('WeChat/WeiXin/confirm')}",
            data:{'numberid':$('input[name=numberid]').val(),'confirm':'true'},
            statusCode: {
                400: function () {
                    thisobj.text('发生错误,登陆失败');
                },
                200:function(){
                    $('#myModal').modal('hide');
                    $('input[name=numberid]').val('');
                    thisobj.text('确认登陆');
                }
            }
        });
    });
</script>